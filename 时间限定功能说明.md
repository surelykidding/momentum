# 任务群时间限定功能说明

## 功能概述

任务群时间限定功能允许为任务群设置完成时间限制，类似于基础单元的时间约束。当任务群超时未完成时，系统会自动清空任务群进度并记录失败。

## 主要特性

### 1. 时间限制设置
- 可以为任务群设置自定义时间限制（1-168小时，即一周内）
- 默认时间限制为24小时
- 只有任务群类型（group）才支持时间限定功能

### 2. 例外规则
- 支持设置例外规则，允许在特定情况下延长或豁免时间限制
- 例外规则包括：紧急会议、生病、突发事件等
- 例外规则可以动态添加和删除

### 3. 自动计时
- 任务群开始执行第一个子任务时自动启动计时器
- 实时显示剩余时间和进度
- 每分钟自动检查过期状态

### 4. 过期处理
- 超时自动清空任务群进度
- 记录失败次数
- 显示过期通知
- 重置开始时间和过期时间

## 使用方法

### 创建带时间限定的任务群

1. 在应用中选择"创建任务群"
2. 填写任务群基本信息（名称、描述等）
3. 在"时间限定设置"部分：
   - 启用时间限制开关
   - 设置时间限制（小时）
   - 添加例外规则（可选）
4. 保存任务群

### 查看时间状态

在任务群详情页面，可以看到：
- 剩余时间显示
- 时间进度条
- 过期状态提示
- 时间限制说明

### 例外规则管理

1. 在任务群编辑页面添加例外规则
2. 例外规则会在超时时提供豁免选项
3. 可以根据实际情况动态调整例外规则

## 技术实现

### 数据库字段
- `time_limit_hours`: 时间限制（小时）
- `time_limit_exceptions`: 例外规则（JSON数组）
- `group_started_at`: 任务群开始时间
- `group_expires_at`: 任务群过期时间

### 核心函数
- `isGroupExpired()`: 检查任务群是否过期
- `getGroupRemainingTime()`: 获取剩余时间
- `startGroupTimer()`: 启动任务群计时器
- `resetGroupProgress()`: 清空任务群进度
- `getGroupTimeStatus()`: 获取完整时间状态

### 自动检查
- 每分钟自动检查所有任务群的过期状态
- 过期任务群自动重置进度
- 实时更新UI显示

## 注意事项

1. **时间限制建议**：根据任务复杂度合理设置时间限制，避免过于严格或过于宽松
2. **例外规则**：合理设置例外规则，避免滥用导致功能失效
3. **进度保存**：系统会自动保存任务群状态，无需手动操作
4. **通知提醒**：过期时会显示通知，提醒用户重新开始任务群

## 未来扩展

- 支持更灵活的时间设置（如按天、按周等）
- 添加时间延展功能
- 支持批量时间设置
- 添加时间统计和分析功能
